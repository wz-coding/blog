---
date: 2024-01-09
category: 
   - Vue
   - Vue3
tag: Diff 算法

---

# Diff 算法
diff 算法是 Vue 渲染器的核心算法，它的目的是当页面或者组件将要更新时，比较新旧两组 vnode（虚拟dom）节点，并以最小的性能开销完成更新操作（能够复用的节点尽量复用，没办法复用的节点再进行 dom 操作）

假设现在有一组 vnode 需要更新：
```js
//旧的 vnode
const oldVnode = {
   type:'div',
   children:[
      { type:'p',children:'1' },
      { type:'p',children:'2' },
      { type:'p',children:'3' },
      { type:'p',children:'4' },
   ]
}

//新的 vnode
const newVnode = {
   type:'div',
   children:[
      { type:'p',children:'1' },
      { type:'p',children:'4' },
      { type:'h1',children:'3' },
      { type:'p',children:'2' },
   ]
}
```
如果不使用 diff 算法直接对新旧 vnode 进行更新操作，那么就要先卸载旧的 3 个子节点，在挂载新的 3 个子节点，一共要执行 6 次操作，这样移除在创建 dom 元素的操作会造成极大的性能开销。下面将探究使用 diff 算法是如何减小操作 dom 的性能开销的。

<Minfo>

这里在更新节点时没有提到使用 `innerHTML` 接口是因为这样做会存在一些问题：
- `innerHTML` 会将容器内所有节点全部清空，但容器的内容可能是由许多其他组件渲染的，这样做不能正确的执行这些组件的 `beforeUnmount`、`unmounted` 等生命周期函数。
- 容器当中的元素可能存在自定义指令，直接清空就不能触发对应的指令钩子函数。
- `innerHTML` 清空元素时不会移除元素上绑定的事件处理函数。

</Minfo>

## 简单 diff

## 双端 diff
## 快速 diff